<!DOCUMENT HTML>
<html>
<head>
  <title>TITLE</title>
</head>
<body>
  <form name="form1">
    <input type="text" name="text1" id="text1" value="" />
    <input type="button" name="btn" id="btn" value="CLICK!!" onclick="focusSet('text1');" />
  </form>
  <script>
    const focusSet = function(id) {
      document.getElementById(id).focus();
    };

    const promise = new Promise(resolve => {
      const fire = () => {
        resolve();
        document.removeEventListener('DOMContentLoaded', fire, false);
        console.log("END DOMContentLoaded !!");
      };
      document.addEventListener('DOMContentLoaded', fire, false);
    });

    window.addEventListener('load', function(){
      console.log("END load !!");
      document.form1.btn.click();
    },false);

    class TouchEmulator {
      constructor(){
        this.touches = []; // 全タッチを保持
      }

      touchstart(id, point){
        const target = document.elementFromPoint(point.x, point.y);
        const touch = this.createTouch(id, target, point);

        // touchesに追加
        this.touches.push(touch);

        this.triggerTouchEvent('touchstart', touch);
      }

      touchmove(id, point){
        const index = this.touches.findIndex(t => t.identifier === id);
        const target = this.touches[index].target;

        const touch = this.createTouch(id, target, point);

        // touchesを更新
        this.touches[index] = touch;

        this.triggerTouchEvent('touchmove', touch);
      }

      touchend(id, point){
        const target = this.touches.find(t => t.identifier === id).target;

        const touch = this.createTouch(id, target, point);

        // touchesから除去
        this.touches = this.touches.filter(t => t.identifier !== id);

        this.triggerTouchEvent('touchend', touch);    
      }

      // Touchをxとyから生成する
      createTouch(identifier, target, point){
        return new Touch({
          identifier,
          target,
          clientX: point.x,
          clientY: point.y,
          pageX: point.x + window.pageXOffset,
          pageY: point.y + window.pageYOffset,
          radiusX: 10,
          radiusY: 10,
          force: 1
        });  
      }

      // TouchEventを作って発火する
      triggerTouchEvent(name, touch) {
        // targetが同じTouchを取り出す
        const targetTouches = this.touches.filter(t => t.target === touch.target);
        const event = new TouchEvent(name, {
          touches: this.touches,
          targetTouches,
          changedTouches: [touch],
          bubbles: true, // これがないとバブリングしない
          cancelable: true,
          view: window
        });
        touch.target.dispatchEvent(event);
      }
    }
  </script>
</body>
</html>